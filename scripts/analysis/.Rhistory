args <- c("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/JB/221019/snake/counts/JB125/221019_star_JB125_dist.tsv.gz",
"221019_star_JB125")
library(tidyverse)
args <- c("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/JB/221019/snake/counts/JB125/221019_star_JB125_dist.tsv.gz",
"221019_star_JB125")
if (!file.exists(args[1])) {
stop("file does not exists. Correct usage is bin_pile_100_python_input_args.R pile_file sample")
}
file <- args[1]
working.dir <- dirname(file)
sample <- args[2]
print(args)
if (is.na(sample)) {
stop("sample not provided. Correct usage is bin_pile_100_python_input_args.R pile_file sample")
}
print(paste0("Analyzing: ",sample))
d_raw <- read_tsv(file,comment="#") %>%
filter(Region=="CDS")
d_normcounts <- d_raw %>%
group_by(ORF) %>%
mutate(counts.norm = Count/sum(Count,na.rm=T)) %>%
ungroup %>%
mutate(start_aligned = Pos) %>%
select(ORF,start_aligned,counts.norm,CDS_length)
bin_orf <- function(df,N,vector) {
bin_vector <- as.integer(cut_interval(vector,n=N,labels=seq(1,N)))
bin_df <- tibble("start_aligned"=vector,"bin_vector"=bin_vector)
df %>% full_join(bin_df,by="start_aligned")
}
d_counts_binned <- d_normcounts %>%
group_by(ORF,CDS_length) %>%
nest %>%
mutate(data=map(data,bin_orf,100,seq(0,CDS_length-1))) %>%
unnest(data) %>%
mutate(bin_vector=bin_vector-1) %>%
ungroup
print("Writing")
d_raw <- read_tsv(file,comment="#") %>%
filter(Region=="CDS")
list.files(file)
file
