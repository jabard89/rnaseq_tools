pivot_wider(names_from="psite_region",values_from="n",names_prefix="n.") %>%
replace(is.na(.), 0)
d_counts_ratio <- d_counts %>%
# filter((n.cds+n.5utr)>100,
#        n.other<50,
#        n.other/n.5utr<0.1) %>%
filter((n.cds+n.5utr)>100) %>%
mutate(ratio=n.5utr/(n.cds+n.5utr))
View(d_counts)
d_counts_ratio <- d_counts %>%
# filter((n.cds+n.5utr)>100,
#        n.other<50,
#        n.other/n.5utr<0.1) %>%
filter((n.cds+n.5utr)>100,
n.other/n.5utr<0.1) %>%
mutate(ratio=n.5utr/(n.cds+n.5utr))
View(d_counts_ratio)
knitr::opts_chunk$set(echo = FALSE,message = FALSE, warning = FALSE)
knitr::asis_output("\U0394  \U2192")
library(tidyverse)
library(cowplot)
library(readxl)
#library(ggpubr)
library(ggsignif)
library(ggrepel)
#library(devtools)
#install_github("jabard89/cat.extras")
library(cat.extras) #has nicely formatted log scales
library(flextable)
`%!in%` = Negate(`%in%`)
theme_set(theme_half_open(font_size=10))
graycol <- "#333333cc"
orangecol <- "#cc5500cc"
bluecol <- "#0000aacc"
greencol <- "#22cc00cc"
purplecol <- "#cc22cccc"
cyancol <- "#2aa198cc"
redcol <- "#dc322fcc"
violetcol <- "#6c71c4cc"
tsp.cols <- c("30C"="black","42C"=orangecol,"46C"=redcol)
label.levels <- c("other","translation_factors","RiBi","RP","glycolysis","MSN2/4","HSF1")
label.cols <- c("translation_factors"=RColorBrewer::brewer.pal(12,"Paired")[10],
"RiBi"=RColorBrewer::brewer.pal(12,"Paired")[10],
"RP"=RColorBrewer::brewer.pal(12,"Paired")[2],
"glycolysis"=RColorBrewer::brewer.pal(12,"Paired")[4],
"MSN2/4"=RColorBrewer::brewer.pal(12,"Paired")[8],
"HSF1"=RColorBrewer::brewer.pal(12,"Paired")[6],
"other"="grey50")
gene_labels <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/JB_analysis/annotation/221025_detailed_labeled_genes_scer.tsv") %>%
rename("length.trans"="LengthTxEst") %>%
mutate(label=detailed_label) %>%
mutate(label=factor(label,levels=label.levels))
src <- "../rsem/riboWaltz/psites"
binned_files <- list.files(src,pattern="*_first300_bin5_codon.tsv.gz")
src <- "../rsem/riboWaltz/psites"
binned_files <- list.files(src,pattern="*_first300_bin5_codon.tsv.gz")
binned_samples <- str_extract(binned_files,".*(?=_first300_bin5_codon.tsv.gz)")
df_samples <- tibble(Sample=binned_samples,File=binned_files) %>%
separate(Sample,into=c("Dataset","Type","Condition","Strain","Depletion","Rep"),
sep="_",remove=F) %>%
mutate(Experiment=paste0(Condition,".",Rep))
df_raw <- df_samples %>% filter(Dataset%in%c("Muhlhofer.2019","Triandafillou.2017","Wu.2019")) %>%
filter(Sample!="Triandafillou.2017_ribo_30C.control_BY4743_ribozero_BR1") %>%
select(File,Sample) %>%
pmap(function(File,Sample){
read_tsv(paste0(src,"/",File)) %>%
mutate("Sample"=Sample)
}) %>% bind_rows %>%
left_join(gene_labels,by="ORF") %>%
left_join(df_samples,by="Sample")
df_bygroup <- df_raw %>% filter(length.prot>300) %>%
group_by(bin,Sample,Condition,Rep,Dataset,label) %>%
summarise(count_norm = median(count_norm))
genes_to_plot <- c("SSA1","SSA2","SSA3","SSA4",
"RTC3","COX2","SPO24","EDC2",
"CDC19","RPS20","YAR1","EFB1",
"SSC1","CCW12","TEF2","UBC4")
df <- df_raw %>% filter(gene%in%genes_to_plot,Dataset!="Muhlhofer.2019") %>%
mutate(gene=factor(gene,levels=genes_to_plot))
ggplot(df,aes(bin,count_norm,color=Condition,linetype=Dataset))+
geom_line(aes(group=Experiment))+
facet_wrap(facets="gene",scales="free")
df <- df_raw %>% filter(gene%in%genes_to_plot,Dataset=="Muhlhofer.2019",Condition%!in%c("37C.30min","42C.30min")) %>%
mutate(gene=factor(gene,levels=genes_to_plot))
ggplot(df,aes(bin,count_norm,color=Condition,linetype=Dataset))+
geom_line(aes(group=Experiment))+
facet_wrap(facets="gene",scales="free")
ggplot(df_bygroup%>%filter(Dataset=="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_grid(label~.,scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset!="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_grid(.~label,scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset=="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_grid(.~label.,scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset=="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_grid(.~label,scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset!="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_grid(.~label,scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset=="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_wrap(facets="label",scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset=="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_wrap(facets="label",scales="free")+
scale_color_viridis_d()
ggplot(df_bygroup%>%filter(Dataset!="Muhlhofer.2019"),
aes(bin,count_norm,color=Condition))+
geom_line(aes(group=Sample),size=1)+
facet_wrap(facets="label",scales="free")+
scale_color_viridis_d()
View(d_counts_ratio)
head(d_count_ratio%>%arrange(ratio),50)
head(d_counts_ratio%>%arrange(ratio),50)
view(d_count_ratio)
view(d_counts_ratio)
d_counts_ratio <- d_counts %>%
# filter((n.cds+n.5utr)>100,
#        n.other<50,
#        n.other/n.5utr<0.1) %>%
filter((n.cds+n.5utr)>100,
n.other/n.5utr<0.5) %>%
mutate(ratio=n.5utr/(n.cds+n.5utr))
View(d_counts_ratio)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#")
View(d_utrs)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#") %>%
mutate(UTR5_length=med5,
UTR3_length=med3) %>%
select(ORF,UTR5_length,UTR3_length)
View(d_utrs)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#") %>%
mutate(UTR5_length=median5,
UTR3_length=median3) %>%
select(ORF,UTR5_length,UTR3_length)
View(d_utrs)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#") %>%
rename("ORF"="gene") %>%
mutate(UTR5_length=median5,
UTR3_length=median3) %>%
select(ORF,UTR5_length,UTR3_length)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#") %>%
rename("ORF"="gene") %>%
mutate(length_UTR5=median5,
length_UTR3=median3) %>%
select(ORF,UTR5_length,UTR3_length)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#") %>%
rename("ORF"="gene") %>%
mutate(length_UTR5=median5,
length_UTR3=median3) %>%
select(ORF,length_UTR5,length_UTR3)
d_counts <- vroom::vroom("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/ribosome_footprinting/rsem/riboWaltz/psites/Weinberg.2016_ribo_30C.control_BY4741_ribozero_BR1_psites.tsv.gz") %>%
rename("ORF"="transcript") %>%
left_join(d_utrs %>% select(ORF,length_UTR3),by="ORF") %>%
mutate(psite_region=if_else(psite<(cds_start-length_UTR5-10),"other",psite_region)) %>%
group_by(ORF) %>%
count(psite_region) %>%
pivot_wider(names_from="psite_region",values_from="n",names_prefix="n.") %>%
replace(is.na(.), 0)
d_counts <- vroom::vroom("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/ribosome_footprinting/rsem/riboWaltz/psites/Weinberg.2016_ribo_30C.control_BY4741_ribozero_BR1_psites.tsv.gz") %>%
rename("ORF"="transcript") %>%
left_join(d_utrs %>% select(ORF,length_UTR5),by="ORF") %>%
mutate(psite_region=if_else(psite<(cds_start-length_UTR5-10),"other",psite_region)) %>%
group_by(ORF) %>%
count(psite_region) %>%
pivot_wider(names_from="psite_region",values_from="n",names_prefix="n.") %>%
replace(is.na(.), 0)
d_counts_ratio <- d_counts %>%
# filter((n.cds+n.5utr)>100,
#        n.other<50,
#        n.other/n.5utr<0.1) %>%
filter((n.cds+n.5utr)>100,
n.other/n.5utr<0.5) %>%
mutate(ratio=n.5utr/(n.cds+n.5utr))
View(d_counts_ratio)
d_counts
View(d_counts_ratio)
View(d_utrs)
d_vienna_utrs
d_pelechano_utrs <- d_vienna_utrs
d_TSS_utrs <- d_vienna_utrs %>%
mutate(length_UTR5 = str_length(UTR5)) %>%
select(ORF,length_UTR5,Source="TSS")
d_TSS_utrs <- d_vienna_utrs %>%
mutate(length_UTR5 = str_length(UTR5)) %>%
select(ORF,length_UTR5) %>%
mutate(Source="TSS")
d_comp_utrs <- d_pelechano_utrs %>%
select(ORF,length_UTR5) %>%
mutate(Source="Pelechano") %>%
bind_rows(d_TSS_utrs)
d_comp_utrs <- d_pelechano_utrs %>%
select(ORF,length_UTR5) %>%
mutate(Source="Pelechano") %>%
bind_rows(d_TSS_utrs) %>%
pivot_wider(names_from=Source,values_from=length_UTR5) %>%
mutate(diff = TSS-Pelechano)
View(d_comp_utrs)
d_comp_utrs <- d_pelechano_utrs %>%
select(ORF,length_UTR5) %>%
mutate(Source="Pelechano") %>%
bind_rows(d_TSS_utrs) %>%
pivot_wider(names_from=Source,values_from=length_UTR5) %>%
mutate(diff = TSS-Pelechano) %>%
drop_na
View(d_comp_utrs)
View(d_vienna_utrs)
View(d_pelechano_utrs)
d_pelechano_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/HeatShockQmRNA/src/Pelechano2013_SuppData3_medianTranscripts.txt",
comment="#") %>%
rename("ORF"="gene") %>%
mutate(length_UTR5=median5,
length_UTR3=median3) %>%
select(ORF,length_UTR5,length_UTR3)
d_TSS_utrs <- d_vienna_utrs %>%
mutate(length_UTR5 = str_length(UTR5)) %>%
select(ORF,length_UTR5) %>%
mutate(Source="TSS")
d_comp_utrs <- d_pelechano_utrs %>%
select(ORF,length_UTR5) %>%
mutate(Source="Pelechano") %>%
bind_rows(d_TSS_utrs) %>%
pivot_wider(names_from=Source,values_from=length_UTR5) %>%
mutate(diff = TSS-Pelechano) %>%
drop_na
View(d_comp_utrs)
source("F:/Dropbox (Drummond Lab)/code_JB/repos/rnaseq_tools/UTRs/merge_UTR_annotations.R", echo=TRUE)
# Created on 230421 by Jared Bard
# merges UTR annotations from yeasTSS and Pelechano_2013
library(tidyverse)
d_pelechano <- read_tsV("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#")
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#")
setwd("F:/Dropbox (Drummond Lab)/code_JB")
setwd("F:/Dropbox (Drummond Lab)/code_JB/repos/rnaseq_tools/UTRs")
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#")
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#")
d_pelechano
d_yeasTSS
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length"="median5",
"UTR3_length"="median3")
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR`)
View(d_yeasTSS)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3")
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF")
View(d_combine)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3") %>%
select(ORF,UTR5_length_pelechano,UTR3_length_pelechano)
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF")
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
View(d_combine)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3") %>%
select(ORF,UTR5_length_pelechano,UTR3_length_pelechano,classification)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3")# %>%
View(d_pelechano)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3") %>%
select(ORF,UTR5_length_pelechano,UTR3_length_pelechano,type)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
View(d_combine)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3") %>%
select(ORF,UTR5_length_pelechano,UTR3_length_pelechano,type)
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
View(d_combine)
YKL163W
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
View(d_combine)
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(small_UTR5_length = min(UTR5_length_yeasTSS,UTR5_length_pelechano))
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(small_UTR5_length = min(UTR5_length_yeasTSS,UTR5_length_pelechano,na.rm=T))
View(d_combine)
combine_utrs <- function(a,b) {
if (is.na(a) & is.na(b)) {
return(NA_integer_)
} else if (is.na(a) & !is.na(b)) {
return(b)
} else if (!is.na(a) & is.na(b)) {
return(a)
} else {
return(min(a,b))
}
mutate(small_UTR5_length = combine_utrs(UTR5_length,UTR3_length))
mutate(small_UTR5_length = combine_utrs(UTR5_lengt_pelechano,UTR3_length_yeasTSS))
mutate(small_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR3_length_yeasTSS))
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(combined_UTR5_length = case_when(is)) %>%
mutate(small_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR3_length_yeasTSS))
?is.na
is_na
t <- is.na(d_yeasTSS$UTR5_length_yeasTSS)
t
View(d_yeasTSS)
View(d_pelechano)
combine_utrs <- function(a,b) {
if (is.na(a) & is.na(b)) {
return(NA_integer_)
} else if (is.na(a) & !is.na(b)) {
return(b)
} else if (!is.na(a) & is.na(b)) {
return(a)
} else {
return(min(a,b))
}
combine_utrs(3,2)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(combined_UTR5_length = case_when(is)) %>%
mutate(small_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS))
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
mutate(combined_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS))
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(combined_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS))
View(d_combine)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3") %>%
select(ORF,UTR5_length_pelechano,UTR3_length_pelechano,type)
d_yeasTSS <- read_csv("Saccharomyces_cerevisiae_YPD_YeasTSS_5UTRs.csv",comment="#") %>%
rename("UTR5_length_yeasTSS"=`5UTR_length`) %>%
select(ORF,UTR5_length_yeasTSS)
combine_utrs <- function(a,b) {
if (is.na(a) & is.na(b)) {
return(NA_integer_)
} else if (is.na(a) & !is.na(b)) {
return(b)
} else if (!is.na(a) & is.na(b)) {
return(a)
} else {
return(min(a,b))
}
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(combined_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS))
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(combined_UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS) %>%
rename("UTR3_length"="UTR3_length_pelechano") %>%
select(ORF,UTR5_length,UTR3_length)
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS) %>%
rename("UTR3_length"="UTR3_length_pelechano") %>%
select(ORF,UTR5_length,UTR3_length) %>%
filter(UTR5_length<900)
?write_lines
?writeLines
?write_lines
?write_tsv
write_tsv(d_combine,out_file,append=T)
source("F:/Dropbox (Drummond Lab)/code_JB/repos/rnaseq_tools/UTRs/merge_UTR_annotations.R", echo=TRUE)
d_pelechano <- read_tsv("Pelechano2013_SuppData3_medianTranscripts.txt",comment="#") %>%
mutate(median5 = floor(median5),
median3 = floor(median3)) %>%
rename('ORF'="gene",
"UTR5_length_pelechano"="median5",
"UTR3_length_pelechano"="median3") %>%
mutate()
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS) %>%
rename("UTR3_length"="UTR3_length_pelechano") %>%
select(ORF,UTR5_length,UTR3_length) %>%
arrange(ORF)
View(d_combine)
combine_utrs <- function(a,b) {
if (is.na(a) & is.na(b)) {
return(NA_integer_)
} else if (is.na(a) & !is.na(b)) {
return(b)
} else if (!is.na(a) & is.na(b)) {
return(a)
} else if (min(a,b) > 900) {
return(NA_integer_)
} else {
return(min(a,b))
}
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS) %>%
rename("UTR3_length"="UTR3_length_pelechano") %>%
select(ORF,UTR5_length,UTR3_length) %>%
arrange(ORF)
View(d_combine)
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)# %>%
View(d_combine)
combine_utrs <- function(a,b) {
if (is.na(a) & is.na(b)) {
out <- NA_integer_
} else if (is.na(a) & !is.na(b)) {
out <- b
} else if (!is.na(a) & is.na(b)) {
out <- a
} else {
out <- min(a,b)
}
return(out)
}
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS)# %>%
View(d_combine)
combine_utrs <- function(a,b) {
if (is.na(a) & is.na(b)) {
return(NA_integer_)
} else if (is.na(a) & !is.na(b)) {
out <- b
} else if (!is.na(a) & is.na(b)) {
out <- a
} else {
out <- min(a,b)
}
if (out > 900) {
return(NA_integer_)
} else {
return(out)
}
d_combine <- full_join(d_pelechano,d_yeasTSS,by="ORF") %>%
rowwise() %>% mutate(UTR5_length = combine_utrs(UTR5_length_pelechano,UTR5_length_yeasTSS)) %>% ungroup %>%
mutate(diff=UTR5_length_pelechano-UTR5_length_yeasTSS) %>%
rename("UTR3_length"="UTR3_length_pelechano") %>%
select(ORF,UTR5_length,UTR3_length) %>%
arrange(ORF)
View(d_combine)
d_utrs <- read_tsv("F:/Dropbox (Drummond Lab)/code_JB/repos/rnaseq_tools/UTRs/Saccharomyces_cerevisiae_YPD_combined_yeasTSS_Pelechano2013_UTRs.tsv",
comment="#")
View(d_utrs)
d_counts <- vroom::vroom("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/ribosome_footprinting/rsem/riboWaltz/psites/Weinberg.2016_ribo_30C.control_BY4741_ribozero_BR1_psites.tsv.gz") %>%
rename("ORF"="transcript") %>%
left_join(d_utrs %>% select(ORF,UTR5_length),by="ORF") %>%
mutate(psite_region=if_else(psite<(cds_start-UTR5_length-10),"other",psite_region)) %>%
group_by(ORF) %>%
count(psite_region) %>%
pivot_wider(names_from="psite_region",values_from="n",names_prefix="n.") %>%
replace(is.na(.), 0)
