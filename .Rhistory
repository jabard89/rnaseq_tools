redcol <- "#dc322fcc"
violetcol <- "#6c71c4cc"
lysate.cols <- c("BR1.30C"=RColorBrewer::brewer.pal(4,"PuOr")[1],
"BR2.30C"=RColorBrewer::brewer.pal(4,"PuOr")[1],
"BR1.37C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"BR1.40C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"BR1.42C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"BR2.42C"=RColorBrewer::brewer.pal(4,"PuOr")[4])
temp.cols <- c("30 °C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"37 °C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"40 °C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"42 °C"=RColorBrewer::brewer.pal(4,"PuOr")[1])
temp.cols.simple <- c("30C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"37C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"40C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"42C"=RColorBrewer::brewer.pal(4,"PuOr")[1])
temp.labels <- c("30C"="30 °C",
"37C"="37 °C",
"40C"="40 °C",
"42C"="42 °C")
# label.cols <- c("ribosomal"=bluecol,
#                 "ribosome biogenesis"=cyancol,
#                 "HSF1"="red",
#                 "glycolytic"=greencol,
#                 "other HS down"=purplecol,
#                 "other HS up"=orangecol,
#                 "other"="grey50",
#                 "Spike"="black")
label.cols <- c("ribosomal"="#0072B2",
"ribosome biogenesis"="#56B4E9",
"HSF1"="#D55E00",
"glycolytic"="#009E73",
"other HS up" = "#E69F00",
"other HS down" = "#CC79A7",
"other"="grey50",
"Spike"="black")
label.levels <- c("HSF1","glycolytic","other HS up",
"ribosomal","ribosome biogenesis",
"other HS down","other","Spike")
gene_labels <- read_tsv("src/201014_labeled_genes_scer.txt") %>%
add_row(gene="Renilla",ORF="Renilla",classification="Verified",label="Spike") %>%
add_row(gene="Nanoluc",ORF="Nanoluc",classification="Verified",label="Spike") %>%
mutate(label=fct_rev(factor(label,levels=label.levels)))
pombe_labels <- read_tsv("src/pombase_220105_gene_IDs_names_products.tsv",
col_names=c("ORF","Pombe_ID2","gene","chr","desc","uniprot","type","synonyms"))
knitr::opts_chunk$set(cache=FALSE, cache.path = "./cache/",
echo = FALSE,message = FALSE, warning = FALSE)
#require(org.Sc.sgd.db)
#require(GO.db)
library(tidyverse)
library(corrr)
library(cowplot)
library(readxl)
library(broom)
library(ggrepel)
#library(devtools)
#install_github("jabard89/cat.extras")
library(cat.extras) #has nicely formatted log scales
library(flextable)
library(zoo)
theme_set(theme_half_open(font_size=16))
graycol <- "#333333cc"
orangecol <- "#cc5500cc"
bluecol <- "#0000aacc"
greencol <- "#22cc00cc"
purplecol <- "#cc22cccc"
cyancol <- "#2aa198cc"
redcol <- "#dc322fcc"
violetcol <- "#6c71c4cc"
lysate.cols <- c("BR1.30C"=RColorBrewer::brewer.pal(4,"PuOr")[1],
"BR2.30C"=RColorBrewer::brewer.pal(4,"PuOr")[1],
"BR1.37C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"BR1.40C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"BR1.42C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"BR2.42C"=RColorBrewer::brewer.pal(4,"PuOr")[4])
temp.cols <- c("30 °C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"37 °C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"40 °C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"42 °C"=RColorBrewer::brewer.pal(4,"PuOr")[1])
temp.cols.simple <- c("30C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"37C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"40C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"42C"=RColorBrewer::brewer.pal(4,"PuOr")[1])
temp.labels <- c("30C"="30 °C",
"37C"="37 °C",
"40C"="40 °C",
"42C"="42 °C")
# label.cols <- c("ribosomal"=bluecol,
#                 "ribosome biogenesis"=cyancol,
#                 "HSF1"="red",
#                 "glycolytic"=greencol,
#                 "other HS down"=purplecol,
#                 "other HS up"=orangecol,
#                 "other"="grey50",
#                 "Spike"="black")
label.cols <- c("ribosomal"="#0072B2",
"ribosome biogenesis"="#56B4E9",
"HSF1"="#D55E00",
"glycolytic"="#009E73",
"other HS up" = "#E69F00",
"other HS down" = "#CC79A7",
"other"="grey50",
"Spike"="black")
label.levels <- c("HSF1","glycolytic","other HS up",
"ribosomal","ribosome biogenesis",
"other HS down","other","Spike")
gene_labels <- read_tsv("src/201014_labeled_genes_scer.txt") %>%
add_row(gene="Clover",ORF="Clover",classification="Verified",label="Spike") %>%
add_row(gene="Nanoluc",ORF="Nanoluc",classification="Verified",label="Spike") %>%
add_row(gene="mCherry",ORF="mCherry",classification="Verified",label="Spike") %>%
mutate(label=fct_rev(factor(label,levels=label.levels)))
solis_data <- read_excel("src/Solis_2016/mmc3.xlsx", skip = 3, col_types = c(rep("text", 2), rep("numeric", 9), "text"),
na="NA")
solis_msn <- filter(solis_data, Gene_Type == "Msn24")$locus
#glycolytic from kegg
kegg <- read_excel("src/KEGG/KEGG_long.xlsx") %>%
mutate(ORF = str_replace_all(ORF,"[[:blank:]]",""))
kegg_label.levels <- c("other","translation factors",
"ribosome subunit","glycolytic","MSN2/4","HSF1")
kegg_label.cols <- c("translation factors"="#56B4E9",
"ribosome subunit"="#0072B2",
#"glycolytic"="#009E73",
"MSN2/4" = "#E69F00",
"HSF1"="#D55E00",
"other"="grey50")
kegg_labels <- gene_labels %>% select(ORF,label) %>%
mutate(kegg_label = case_when(
label=="HSF1"~"HSF1",
ORF%in%kegg[kegg$Description=="RP",]$ORF ~ "ribosome subunit",
ORF%in%kegg[kegg$Description=="Translation",]$ORF ~ "translation factors",
ORF%in%kegg[kegg$Description=="Ribi",]$ORF ~ "translation factors",
#ORF%in%kegg[kegg$Description=="Glycolysis",]$ORF ~ "glycolytic",
ORF%in%solis_msn ~ "MSN2/4",
TRUE~"other"
)) %>%
select(ORF,kegg_label) %>%
mutate(kegg_label=factor(kegg_label,levels=kegg_label.levels))
src.directory <- c("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/JB/220301/star/counts")
src.directory <- c("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/JB/220301/")
count_files <- list.files(paste0(src.directory,"/star/counts/"),
pattern="220403_STAR_bin100_.*\\.tsv\\.gz",full.names = T,recursive=T)
samples <- read_excel(paste0(src.directory,"220301-samples.xlsx"))
names <- str_extract(count_files,pattern="(?<=220403_counts_bin100_).*(?=\\.tsv.gz)")
names <- str_extract(count_files,pattern="(?<=220403_STAR_bin100_).*(?=\\.tsv.gz)")
names
View(samples)
src.directory <- c("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/JB/220301/")
count_files <- list.files(paste0(src.directory,"/star/counts/"),
pattern="220403_STAR_bin100_.*\\.tsv\\.gz",full.names = T,recursive=T)
samples <- read_excel(paste0(src.directory,"220301-samples.xlsx"))
names <- str_extract(count_files,pattern="(?<=220403_STAR_bin100_).*(?=\\.tsv.gz)")
d_bin10to90_byORF <- count_files %>% map2(names,function(file,name) {
read_tsv(file,
col_types = c(ORF="c",counts="d",bin="d",TPM.STAR="d"),comment="#") %>%
mutate("Sample"=name) %>%
filter(bin>9,bin<91) %>%
left_join(samples,by="Sample")
})
View(d_bin10to90_byORF)
d_SSA <- d_bin10to90_byORF %>% map(function(df){
df %>% filter(ORF%in%c("YAL005C","YBL075C","YER103W","YLL024C"))
}) %>% bind_rows
View(d_SSA)
d_ssa_renorm <- d_SSA %>%
left_join(d_SSA %>% group_by(ORF,Sample) %>%
summarise(count_total=sum(counts)),
by=c("ORF","Sample")) %>%
mutate(count_renorm = counts/count_total) %>%
mutate(big_bin = case_when(bin<25~"bin1",
bin>=25&bin<50~"bin2",
bin>=50&bin<75~"bin3",
bin>=75~"bin4")) %>%
group_by(ORF,Sample,Temperature,Fraction,Biorep,Treatment_group,Treat,big_bin) %>%
summarise(count_renorm = sum(count_renorm,na.rm=T))
View(d_ssa_renorm)
colnames(d_bin10to90_byORF[[1]])
d_totals <- d_bin10to90_by_ORF %>% map(function(df){
df %>% select(ORF,TPM.STAR,Sample,Strain,Treatment_group,Treat,Temperature,Biorep,Fraction) %>%
unique
}) %>% bind_rows
d_totals <- d_bin10to90_byORF %>% map(function(df){
df %>% select(ORF,TPM.STAR,Sample,Strain,Treatment_group,Treat,Temperature,Biorep,Fraction) %>%
unique
}) %>% bind_rows
knitr::opts_chunk$set(cache=FALSE, cache.path = "./cache/",
echo = FALSE,message = FALSE, warning = FALSE)
#require(org.Sc.sgd.db)
#require(GO.db)
library(tidyverse)
library(corrr)
library(cowplot)
library(readxl)
library(broom)
library(ggrepel)
#library(devtools)
#install_github("jabard89/cat.extras")
library(cat.extras) #has nicely formatted log scales
library(flextable)
library(zoo)
theme_set(theme_half_open(font_size=16))
graycol <- "#333333cc"
orangecol <- "#cc5500cc"
bluecol <- "#0000aacc"
greencol <- "#22cc00cc"
purplecol <- "#cc22cccc"
cyancol <- "#2aa198cc"
redcol <- "#dc322fcc"
violetcol <- "#6c71c4cc"
temp.cols <- c("30C"=RColorBrewer::brewer.pal(4,"PuOr")[4],
"37C"=RColorBrewer::brewer.pal(4,"PuOr")[3],
"40C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"42C"=RColorBrewer::brewer.pal(4,"PuOr")[1])
gene_labels_raw <- read_tsv("src/201014_labeled_genes_scer.txt")
solis_data <- read_excel("src/Solis_2016/mmc3.xlsx", skip = 3, col_types = c(rep("text", 2), rep("numeric", 9), "text"),
na="NA")
solis_msn <- filter(solis_data, Gene_Type == "Msn24")$locus
#glycolytic from kegg
kegg <- read_excel("src/KEGG/KEGG_long.xlsx") %>%
mutate(ORF = str_replace_all(ORF,"[[:blank:]]",""))
label.levels <- c("spike","other","translation","glycolysis","MSN2/4","HSF1")
label.cols <- c("translation"="#56B4E9",
"glycolysis"="#CC79A7",
"MSN2/4" = "#E69F00",
"HSF1"="#D55E00",
"other"="grey50",
"spike"="black")
gene_labels <- gene_labels_raw %>% select(ORF,gene,length.prot,classification,label) %>%
rename("old_label"="label") %>%
mutate(label = case_when(
old_label=="HSF1"~"HSF1",
ORF%in%kegg[kegg$Description=="RP",]$ORF ~ "translation",
ORF%in%kegg[kegg$Description=="Translation",]$ORF ~ "translation",
ORF%in%kegg[kegg$Description=="Ribi",]$ORF ~ "translation",
ORF%in%kegg[kegg$Description=="Glycolysis",]$ORF ~ "glycolysis",
ORF%in%solis_msn ~ "MSN2/4",
TRUE~"other"
)) %>%
select(-old_label) %>%
add_row(gene="Clover",ORF="Clover",classification="Verified",label=="spike") %>%
add_row(gene="Nanoluc",ORF="Nanoluc",classification="Verified",label=="spike") %>%
add_row(gene="mCherry",ORF="mCherry",classification="Verified",label=="spike") %>%
mutate(label=factor(label,levels=label.levels))
gene_labels <- gene_labels_raw %>% select(ORF,gene,length.prot,classification,label) %>%
rename("old_label"="label") %>%
mutate(label = case_when(
old_label=="HSF1"~"HSF1",
ORF%in%kegg[kegg$Description=="RP",]$ORF ~ "translation",
ORF%in%kegg[kegg$Description=="Translation",]$ORF ~ "translation",
ORF%in%kegg[kegg$Description=="Ribi",]$ORF ~ "translation",
ORF%in%kegg[kegg$Description=="Glycolysis",]$ORF ~ "glycolysis",
ORF%in%solis_msn ~ "MSN2/4",
TRUE~"other"
)) %>%
select(-old_label) %>%
add_row(gene="Clover",ORF="Clover",classification="Verified",label="spike") %>%
add_row(gene="Nanoluc",ORF="Nanoluc",classification="Verified",label="spike") %>%
add_row(gene="mCherry",ORF="mCherry",classification="Verified",label="spike") %>%
mutate(label=factor(label,levels=label.levels))
temp.cols2 <- c("30C"="black",
"37C"=RColorBrewer::brewer.pal(4,"PuOr")[2],
"42C"=RColorBrewer::brewer.pal(4,"PuOr")[1],
"46C" = "red")
d_tpm <- d_totals
d_totals <- d_tpm %>%
filter(Fraction=="Total") %>% left_join(gene_labels,by="ORF") %>%
filter(classification=="Verified") %>%
arrange(label)
View(d_totals)
d_ref_30C <- d_totals %>% filter(Temperature=="30C",Treat==FALSE) %>%
group_by(ORF,Treatment_group) %>%
summarise(TPM_30C_mean = exp(mean(log(TPM_norm),na.rm=T)))
d_ref_30C <- d_totals %>% filter(Temperature=="30C",Treat==FALSE) %>%
group_by(ORF,Treatment_group) %>%
summarise(TPM_30C_mean = exp(mean(log(TPM.STAR),na.rm=T)))
d_totals_fc <- d_totals %>%
left_join(d_ref_30C,by=c("ORF","Treatment_group")) %>%
mutate(TPM.FC = TPM.STAR/TPM_30C_mean)
View(d_totals_fc)
y_chx <- d_totals_fc %>% filter(Treatment_group=="CHX")
y_chx_comp <- y_chx %>%
select(ORF,gene,TPM.FC,label,Treat,Temperature,Biorep) %>%
pivot_wider(names_from=Treat,values_from=TPM.FC,names_prefix="Treat.")
ggplot(y_chx,
aes(x=TPM_30C_mean,y=TPM.STAR,color=label))+
geom_point(data=y_chx%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(paste0(Treatment_group,".",Treat,".",Biorep)~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-2,1e3),ylim=c(1e-2,1e3))
ggplot(y_chx_comp,
aes(x=Treat.FALSE,y=Treat.TRUE,color=label))+
geom_point(data=y_chx_comp%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx_comp%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(Biorep~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-2,1e3),ylim=c(1e-2,1e3))
sample_names
names
d_totals <- d_tpm %>%
filter(Fraction=="Total") %>% left_join(gene_labels,by="ORF") %>%
filter(classification=="Verified") %>%
arrange(label)
d_ref_30C <- d_totals %>% filter(Temperature=="30C",Treat==FALSE) %>%
group_by(ORF,Treatment_group) %>%
summarise(TPM_30C_mean = exp(mean(log(TPM.STAR),na.rm=T)))
d_totals_fc <- d_totals %>%
left_join(d_ref_30C,by=c("ORF","Treatment_group")) %>%
mutate(TPM.FC = TPM.STAR/TPM_30C_mean)
y_chx <- d_totals_fc %>% filter(Treatment_group=="CHX")
y_chx_comp <- y_chx %>%
select(ORF,gene,TPM.FC,label,Treat,Temperature,Biorep) %>%
pivot_wider(names_from=Treat,values_from=TPM.FC,names_prefix="Treat.")
ggplot(y_chx,
aes(x=TPM_30C_mean,y=TPM.STAR,color=label))+
geom_point(data=y_chx%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(paste0(Treatment_group,".",Treat,".",Biorep)~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-2,1e3),ylim=c(1e-2,1e3))
ggplot(y_chx_comp,
aes(x=Treat.FALSE,y=Treat.TRUE,color=label))+
geom_point(data=y_chx_comp%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx_comp%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(Biorep~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-2,1e3),ylim=c(1e-2,1e3))
colnames(d_tpm)
d_tpm_med <- d_tpm %>%
group_by(Sample) %>%
summarise(TPM.med = median(TPM.STAR,na.rm=T))
d_tpm_raw <- d_tpm
d_tpm <- d_tpm_raw %>%
left_join(d_tpm_med,by="Sample") %>%
mutate(TPM = TPM.STAR/TPM.med)
d_totals <- d_tpm %>%
filter(Fraction=="Total") %>% left_join(gene_labels,by="ORF") %>%
filter(classification=="Verified") %>%
arrange(label)
d_tpm_med <- d_tpm_raw %>%
group_by(Sample) %>%
summarise(TPM.med = median(TPM.STAR,na.rm=T))
d_tpm <- d_tpm_raw %>%
left_join(d_tpm_med,by="Sample") %>%
mutate(TPM = TPM.STAR/TPM.med)
d_totals <- d_tpm %>%
filter(Fraction=="Total") %>% left_join(gene_labels,by="ORF") %>%
filter(classification=="Verified") %>%
arrange(label)
d_ref_30C <- d_totals %>% filter(Temperature=="30C",Treat==FALSE) %>%
group_by(ORF,Treatment_group) %>%
summarise(TPM_30C_mean = exp(mean(log(TPM),na.rm=T)))
d_totals_fc <- d_totals %>%
left_join(d_ref_30C,by=c("ORF","Treatment_group")) %>%
mutate(TPM.FC = TPM/TPM_30C_mean)
View(d_totals_fc)
y_chx <- d_totals_fc %>% filter(Treatment_group=="CHX")
y_chx_comp <- y_chx %>%
select(ORF,gene,TPM.FC,label,Treat,Temperature,Biorep) %>%
pivot_wider(names_from=Treat,values_from=TPM.FC,names_prefix="Treat.")
ggplot(y_chx,
aes(x=TPM_30C_mean,y=TPM.STAR,color=label))+
geom_point(data=y_chx%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(paste0(Treatment_group,".",Treat,".",Biorep)~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-2,1e3),ylim=c(1e-2,1e3))
ggplot(y_chx_comp,
aes(x=Treat.FALSE,y=Treat.TRUE,color=label))+
geom_point(data=y_chx_comp%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx_comp%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(Biorep~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-2,1e3),ylim=c(1e-2,1e3))
y_chx <- d_totals_fc %>% filter(Treatment_group=="CHX")
y_chx_comp <- y_chx %>%
select(ORF,gene,TPM.FC,label,Treat,Temperature,Biorep) %>%
pivot_wider(names_from=Treat,values_from=TPM.FC,names_prefix="Treat.")
ggplot(y_chx,
aes(x=TPM_30C_mean,y=TPM.STAR,color=label))+
geom_point(data=y_chx%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(paste0(Treatment_group,".",Treat,".",Biorep)~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-3,1e4),ylim=c(1e-3,1e4))
ggplot(y_chx_comp,
aes(x=Treat.FALSE,y=Treat.TRUE,color=label))+
geom_point(data=y_chx_comp%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx_comp%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(Biorep~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-1,1e2),ylim=c(0.5e-1,2e1))
ggplot(y_chx,
aes(x=TPM_30C_mean,y=TPM.STAR,color=label))+
geom_point(data=y_chx%>%filter(label=="other"),alpha=0.1)+
geom_point(data=y_chx%>%filter(label!="other"),alpha=0.3)+
scale_loglog()+
facet_grid(paste0(Treatment_group,".",Treat,".",Biorep)~Temperature)+
scale_color_manual(values=label.cols)+
coord_cartesian(xlim=c(1e-3,5e4),ylim=c(1e-3,5e4))
d_bin1090 <- d_bin10to90_byORF %>% map(function(df){
total <- df %>% group_by(ORF) %>%
summarise(count_total = sum(counts))
t <- df %>% left_join(total,by=c("ORF")) %>%
mutate(counts.renorm = counts/count_total) %>%
group_by(Sample,Temperature,Treatment_group,Treat,Biorep,bin) %>%
summarise(counts.mean = mean(counts.renorm))
}) %>% bind_rows %>%
group_by(Sample,Temperature,Treatment_group,Treat,Biorep,bin) %>%
summarise(counts.mean=mean(counts.mean))
d_bin1090.FC <- d_bin1090 %>% filter(Fraction!="Total") %>%
left_join(d_bin1090 %>% filter(Fraction=="Total") %>%
ungroup %>%
mutate(counts.mean.total = counts.mean) %>%
select(Sample,bin,counts.mean.total),
by=c("bin","Sample")) %>%
mutate(fraction.bias = counts.mean/counts.mean.total)
View(d_bin1090)
colnames(d_bin1090)
d_bin1090 <- d_bin10to90_byORF %>% map(function(df){
total <- df %>% group_by(ORF) %>%
summarise(count_total = sum(counts))
t <- df %>% left_join(total,by=c("ORF")) %>%
mutate(counts.renorm = counts/count_total) %>%
group_by(Sample,Temperature,Treatment_group,Treat,Biorep,bin) %>%
summarise(counts.mean = mean(counts.renorm))
}) %>% bind_rows %>%
group_by(Sample,Fraction,Temperature,Treatment_group,Treat,Biorep,bin) %>%
summarise(counts.mean=mean(counts.mean))
d_bin1090 <- d_bin10to90_byORF %>% map(function(df){
total <- df %>% group_by(ORF) %>%
summarise(count_total = sum(counts))
t <- df %>% left_join(total,by=c("ORF")) %>%
mutate(counts.renorm = counts/count_total) %>%
group_by(Sample,Fraction,Temperature,Treatment_group,Treat,Biorep,bin) %>%
summarise(counts.mean = mean(counts.renorm))
}) %>% bind_rows %>%
group_by(Sample,Fraction,Temperature,Treatment_group,Treat,Biorep,bin) %>%
summarise(counts.mean=mean(counts.mean))
d_bin1090.FC <- d_bin1090 %>% filter(Fraction!="Total") %>%
left_join(d_bin1090 %>% filter(Fraction=="Total") %>%
ungroup %>%
mutate(counts.mean.total = counts.mean) %>%
select(Sample,bin,counts.mean.total),
by=c("bin","Sample")) %>%
mutate(fraction.bias = counts.mean/counts.mean.total)
ggplot(d_bin1090%>%filter(Temperature=="30C"),
aes(x=bin,y=counts.mean,color=paste0(Fraction,".",Biorep)))+
geom_line(size=0.5)+
labs(x="transcript bin",y="Norm. Counts 30C")
ggplot(d_bin1090.FC %>% filter(bin>=10,bin<=90),
aes(x=bin,y=fraction.bias,
color=Temperature,group=Temperature))+
geom_hline(yintercept=1,linetype="dotted")+
#geom_point(size=0.5,alpha=0.3)+
geom_line(aes(y=fraction.bias,color=Temperature,group=Temperature),size=0.5)+
facet_grid(.~Fraction)+
scale_color_brewer(palette="PuOr",direction=-1)+
labs(y="Fraction Bias\n(counts norm. to total)",x="transcript bin")
ggplot(d_bin1090%>%filter(Temperature=="30C"),
aes(x=bin,y=counts.mean,color=paste0(Fraction,".",Biorep)))+
geom_line(size=0.5)+
facet_grid(Treatment_group~Treat)+
labs(x="transcript bin",y="Norm. Counts 30C")
View(d_SSA)
d_SSA %>% count(bin)
d_SSA %>% group_by(Sample) %>% count(bin)
args <- c("F:/Dropbox (Drummond Lab)/Data_JB/RNA-seq/JB/220301/star/counts/HG01/220403_STAR_HG01_dist.tsv",
"220403_STAR_","_dist.tsv")
file <- args[1]
working.dir <- dirname(file)
name <- str_extract(file,pattern=paste0("(?<=",args[2],").*(?=",args[3],")"))
gene_labels <- read_tsv("src/201014_labeled_genes_scer.txt") %>%
mutate(length.CDS=length.prot*3)
print(paste0("Analyzing: ",name))
d_raw0 <- read_tsv(file,comment="#") %>%
left_join(gene_labels %>% select(ORF,length.CDS),by="ORF") %>%
rename("Counts"="Count") %>%
filter(!is.na(length.CDS))
gene_labels
gene_labels <- read_tsv("src/201014_labeled_genes_scer.txt") %>%
mutate(length.CDS=length.prot*3)
setwd("F:/Dropbox (Drummond Lab)/code_JB/repos/rnaseq_tools")
gene_labels <- read_tsv("src/201014_labeled_genes_scer.txt") %>%
mutate(length.CDS=length.prot*3)
gene_labels <- read_tsv("/src/201014_labeled_genes_scer.txt") %>%
mutate(length.CDS=length.prot*3)
gene_labels <- read_tsv("src/201014_labeled_genes_scer.txt") %>%
mutate(length.CDS=length.prot*3)
gene_labels <- read_tsv("src/annotations/201014_labeled_genes_scer.txt") %>%
mutate(length.CDS=length.prot*3)
d_raw0 <- read_tsv(file,comment="#") %>%
left_join(gene_labels %>% select(ORF,length.CDS),by="ORF") %>%
rename("Counts"="Count") %>%
filter(!is.na(length.CDS))
view(d_raw0 %>% filter(ORF=="YAL005C"))
# find min and max
d_length <- d_raw0 %>% select(Pos,ORF,length.CDS) %>%
group_by(ORF,length.CDS) %>% nest %>%
mutate(start = map_dbl(data,function(df){min(df$Pos)}),
end = map_dbl(data,function(df){max(df$Pos)})) %>%
select(-data) %>% ungroup %>%
mutate(start=if_else(start>-10,-10,start),
end=if_else(end<(length.CDS+9),length.CDS+9,end),
length.trans=end-start) #expand transcripts to at least the CDS length
